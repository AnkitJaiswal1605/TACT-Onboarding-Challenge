"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.precompile = void 0;
const resolveDescriptors_1 = require("../types/resolveDescriptors");
const resolveAllocation_1 = require("../storage/resolveAllocation");
const store_1 = require("../grammar/store");
const resolveStatements_1 = require("../types/resolveStatements");
const resolveErrors_1 = require("../types/resolveErrors");
const resolveSignatures_1 = require("../types/resolveSignatures");
const resolveImports_1 = require("../imports/resolveImports");
function precompile(ctx, project, stdlib, entrypoint) {
    // Load all sources
    let imported = (0, resolveImports_1.resolveImports)({ entrypoint, project, stdlib });
    // Perform initial compiler steps
    ctx = (0, store_1.openContext)(ctx, imported.tact, imported.func);
    // First load type descriptors and check that 
    //       they all have valid signatures
    ctx = (0, resolveDescriptors_1.resolveDescriptors)(ctx);
    // This creates TLB-style type definitions
    ctx = (0, resolveSignatures_1.resolveSignatures)(ctx);
    // This creates allocations for all defined types
    ctx = (0, resolveAllocation_1.resolveAllocations)(ctx);
    // This checks and resolves all statements
    ctx = (0, resolveStatements_1.resolveStatements)(ctx);
    // This extracts error messages
    ctx = (0, resolveErrors_1.resolveErrors)(ctx);
    // Prepared context
    return ctx;
}
exports.precompile = precompile;
